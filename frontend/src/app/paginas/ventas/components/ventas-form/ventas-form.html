<form
  [formGroup]="ventaForm"
  (ngSubmit)="onSubmit()"
  class="py-4 flex flex-wrap flex-col gap-4 md:flex-row"
>
  <!-- Información del cliente -->
  <mat-card class="p-5 rounded-2xl! dark:bg-gray-700! flex-auto md:w-1/2">
    <mat-card-title>
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <mat-icon class="w-5! h-5! text-cyan-400!">person</mat-icon>
        Información del Cliente
      </h3>
    </mat-card-title>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Tipo de documento</mat-label>
      <mat-select formControlName="tipoDocumento">
        @for (td of tiposDocumento(); track $index) {
        <mat-option [value]="td">{{ td }}</mat-option>
        }
      </mat-select>
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Número de documento</mat-label>
      <input matInput formControlName="documento" (blur)="consultarCliente()" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="nombre" />
    </mat-form-field>

    <mat-form-field appearance="fill" class="w-full">
      <mat-label>Apellido</mat-label>
      <input matInput formControlName="apellido" />
    </mat-form-field>
  </mat-card>

  <!-- Productos -->
  <mat-card class="p-5 rounded-2xl! dark:bg-gray-700! flex-auto md:w-[48.5%]">
    <mat-card-title>
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <mat-icon class="size-5! text-cyan-400!">inventory</mat-icon>
        Productos disponibles
      </h3>
    </mat-card-title>

    <mat-card-content>
      <div class="grid grid-cols-1 gap-2 max-h-96 overflow-y-auto pr-2">
        @for (prod of productos(); track prod.id) {
        <mat-card class="dark:bg-gray-600! rounded-2xl!">
          <mat-card-content>
            <mat-card-title>{{ prod.nombre }}</mat-card-title>
            <mat-card-subtitle>Stock: {{ prod.stock }}</mat-card-subtitle>
            <mat-card-subtitle>Precio: {{ prod.precio | currency : 'COP' }}</mat-card-subtitle>
            <mat-card-actions align="end">
              <button mat-mini-fab color="primary" (click)="agregarProducto(prod)" [disabled]="prod.stock == 0" type="button">
                <mat-icon>add</mat-icon>
              </button>
            </mat-card-actions>
          </mat-card-content>
        </mat-card>
        }
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Detalle de venta -->
  <mat-card class="p-5 rounded-2xl! dark:bg-gray-700! w-full">
    <mat-card-title>
      <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
        <mat-icon class="w-5! h-5! text-cyan-400!">shopping_cart</mat-icon>
        Detalle de la venta
      </h3>
    </mat-card-title>

    <div class="overflow-x-auto">
      <table
        mat-table
        [dataSource]="carrito()"
        class="min-w-full border border-gray-200! dark:border-gray-700! rounded-lg"
      >
        <!-- Nombre -->
        <ng-container matColumnDef="nombre">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-left py-3 px-4 font-semibold bg-gray-100! dark:bg-[#0f172a]!"
          >
            Nombre
          </th>
          <td mat-cell *matCellDef="let element" class="py-3 px-4 border-t dark:border-gray-800!">
            {{ element.nombre }}
          </td>
        </ng-container>

        <!-- Cantidad -->
        <ng-container matColumnDef="cantidad">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-left py-3 px-4 font-semibold bg-gray-100! dark:bg-[#0f172a]!"
          >
            Cantidad
          </th>
          <td mat-cell *matCellDef="let element" class="py-3 px-4 border-t dark:border-gray-800!">
            {{ element.cantidad }}
          </td>
        </ng-container>

        <!-- Precio -->
        <ng-container matColumnDef="precio">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-left py-3 px-4 font-semibold bg-gray-100! dark:bg-[#0f172a]!"
          >
            Precio
          </th>
          <td mat-cell *matCellDef="let element" class="py-3 px-4 border-t dark:border-gray-800!">
            {{ element.precio }}
          </td>
        </ng-container>

        <!-- Subtotal -->
        <ng-container matColumnDef="subtotal">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-left py-3 px-4 font-semibold bg-gray-100! dark:bg-[#0f172a]!"
          >
            Subtotal
          </th>
          <td mat-cell *matCellDef="let element" class="py-3 px-4 border-t dark:border-gray-800!">
            {{ element.precio * element.cantidad | currency : 'COP' }}
          </td>
        </ng-container>

        <!-- Eliminar -->
        <ng-container matColumnDef="eliminar">
          <th
            mat-header-cell
            *matHeaderCellDef
            class="text-left py-3 px-4 font-semibold bg-gray-100! dark:bg-[#0f172a]!"
          >
            Eliminar producto
          </th>
          <td mat-cell *matCellDef="let element" class="py-3 px-4 border-t dark:border-gray-800!">
            <button mat-icon-button color="warn" (click)="eliminarProducto(element.id)">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="text-sm"></tr>
        <tr
          mat-row
          *matRowDef="let row; columns: displayedColumns"
          class="hover:bg-gray-50! dark:hover:bg-[#1e293b]/70!"
        ></tr>
      </table>
    </div>

    <div class="mt-4 flex justify-end items-center gap-4">
      <p class="text-lg font-semibold">Total: {{ total() | currency : 'COP' }}</p>
      <button mat-flat-button color="accent" class="bg-cyan-600! text-white!" type="submit">
        Registrar venta
      </button>
    </div>
  </mat-card>
</form>
